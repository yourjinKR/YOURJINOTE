


# 루틴 체크

```tasks
not done
```

# 완료

```tasks
done
done today
```


API 호출 및 응답에 대한 기록을 아래와 같이 저장하고 있어. 이는 `AILogResponse`를 기반으로 응답 받은 것이야. `inputContent`를 어떤 식으로 관리하는 것이 좋을까?

참고로 mysql의 table의 데이터 타입은 json임.

```sql
create table ai_logs
(
    id                   bigint auto_increment
        primary key,
    elapsed_ms           bigint                                             null,
    feature              varchar(64)                                        not null,
    input_content        json                                               null,
    input_tokens         bigint                                             null,
    model                enum ('GPT_4_1_MINI')                              not null,
    output_content       json                                               null,
    output_tokens        bigint                                             null,
    requestId            varchar(64)                                        not null,
    request_time         datetime(6)                                        null,
    response_time        datetime(6)                                        null,
    status               enum ('EXCEPTION', 'FAILURE', 'SUCCESS')           null,
    status_message       varchar(255)                                       null,
    user_action          enum ('SAVE_IMMEDIATE', 'SAVE_LATER', 'SKIP_SA기

#### 참고 자료 

```java
package app.fitsync.domain.ai.dto;  
  
import app.fitsync.domain.ai.entity.AIModel;  
import app.fitsync.domain.ai.entity.CallStatus;  
import app.fitsync.domain.ai.entity.FeedBackStatus;  
import app.fitsync.domain.ai.entity.UserAction;  
import java.time.LocalDateTime;  
import java.util.Map;  
  
public record AILogResponse(  
        Long id,  
        String requestId,  
        Long userId,  
        AIModel model,  
        String feature,  
        String version,  
        Map<String, Object> inputContent,  
        Map<String, Object> outputContent,  
        Long inputTokens,  
        Long outputTokens,  
        LocalDateTime requestTime,  
        LocalDateTime responseTime,  
        Long elapsedMs,  
        CallStatus status,  
        String statusMessage,  
        FeedBackStatus userFeedBack,  
        String userFeedBackReason,  
        UserAction userAction  
) {  
}
```

```json
{
    "id": 1,
    "requestId": "3351631b-716a-4e88-8e13-999e0ed275cf",
    "userId": 1,
    "model": "GPT_4_1_MINI",
    "feature": "ROUTINE_RECOMMEND",
    "version": "0.0.1",
    "inputContent": {
        "userMessage": "내 정보 : UserHeaderInfoResponse[name=유어진, age=25, hidden=false], 내 프로필 : UserProfileDetailResponse[workoutGoals=[MUSCLE_GAIN, WEIGHT_LOSS], exerciseCategories=[FITNESS, CROSSFIT], disease=허리 디스크, height=175.0, weight=72.5, skeletalMuscleMass=32.1, bodyFatMass=20.4, bodyFatPercentage=20.4, bmi=23.7], 루틴 분할 수 5",
        "systemPrompt": "# 시스템 지침\n- 당신은 운동 루틴 추천을 생성하는 AI이다.\n- 반드시 아래 \"응답 형식\"을 만족하는 JSON만 출력한다.\n- JSON 외의 텍스트(설명/주석/코드펜스/마크다운/인삿말/추가 문장)를 절대 출력하지 않는다.\n- 최상위는 JSON 객체 1개여야 한다.\n- 최상위 객체는 반드시 \"result\" 프로퍼티를 가진다.\n- \"result\"는 반드시 배열(array)이어야 하며, 최소 1개 이상의 루틴 객체를 포함해야 한다.\n\n# 데이터 제약\n- exerciseId, exerciseName은 \"서버가 제공한 목록\"에 포함된 운동만 사용할 수 있다.\n- candidateExercises 목록에 없는 운동을 새로 만들어내거나 임의로 추정하지 않는다.\n- exerciseId와 exerciseName은 항상 서로 일치해야 한다. (예: id 10의 name이 '벤치프레스'면 다른 이름을 쓰면 안 됨)\n- 유저 메시지(나이/목표/질환/선호 부위/분할 수 등)를 참고하여 루틴을 구성한다.\n- 사용자가 요청한 분할 수와 result 배열의 길이와 동일하다.\n\n# 값 규칙\n- RoutineSet의 수치 필드는 다음 규칙을 따른다.\n  - weightKg: 정수 또는 null (맨몸/체중운동이면 null 가능)\n  - reps: 정수 또는 null (유산소/시간기반이면 null 가능)\n  - distanceM: 정수 또는 null (거리 기반 운동일 때만 값)\n  - durationSec: 정수 또는 null (시간 기반 운동일 때만 값)\n  - speedKmh: 정수 또는 null (속도 기반 운동일 때만 값)\n  - rpe: 정수 또는 null (자각강도 1~10 권장, 모르면 null)\n  - restTimeSec: 정수 또는 null (세트 간 휴식, 모르면 null)\n- 위 필드들 중 해당 운동에 의미 없는 값은 null로 둔다. (예: 근력운동에서 distanceM은 null)\n- 숫자 값은 문자열로 출력하지 않는다. (따옴표 없이 숫자로 출력)\n\n# 응답 형식 (AIRoutineResponse DTO)\n아래 JSON 구조를 반드시 정확히 따른다. 키 이름/대소문자/중첩 구조를 변경하지 않는다.\n\n{\n  \"result\": [\n    {\n      \"name\": \"string\",\n      \"routineExercises\": [\n        {\n          \"exerciseId\": 0,\n          \"exerciseName\": \"string\",\n          \"routineSets\": [\n            {\n              \"weightKg\": 0,\n              \"reps\": 0,\n              \"distanceM\": 0,\n              \"durationSec\": 0,\n              \"speedKmh\": 0,\n              \"rpe\": 0,\n              \"restTimeSec\": 0\n            }\n          ]\n        }\n      ]\n    }\n  ]\n}\n\n# 추가 출력 금지\n- 위 JSON 객체 외에는 어떤 문자도 출력하지 않는다.\n- JSON을 ```json 코드블록으로 감싸지 않는다.\n",
        "inputAssistantMessage": ""
    },
    "outputContent": {
        "result": {
            "result": [
                {
                    "name": "루틴 1",
                    "routineExercises": [
                        {
                            "exerciseId": 1001,
                            "routineSets": [
                                {
                                    "rpe": 7,
                                    "reps": 8,
                                    "speedKmh": null,
                                    "weightKg": 70,
                                    "distanceM": null,
                                    "durationSec": null,
                                    "restTimeSec": 90
                                },
                                {
                                    "rpe": 7,
                                    "reps": 8,
                                    "speedKmh": null,
                                    "weightKg": 70,
                                    "distanceM": null,
                                    "durationSec": null,
                                    "restTimeSec": 90
                                }
                            ],
                            "exerciseName": "벤치프레스"
                        },
                        {
                            "exerciseId": 1006,
                            "routineSets": [
                                {
                                    "rpe": 6,
                                    "reps": 12,
                                    "speedKmh": null,
                                    "weightKg": 20,
                                    "distanceM": null,
                                    "durationSec": null,
                                    "restTimeSec": 60
                                },
                                {
                                    "rpe": 6,
                                    "reps": 12,
                                    "speedKmh": null,
                                    "weightKg": 20,
                                    "distanceM": null,
                                    "durationSec": null,
                                    "restTimeSec": 60
                                }
                            ],
                            "exerciseName": "넓벅 플라이"
                        }
                    ]
                },
                {
                    "name": "루틴 2",
                    "routineExercises": [
                        {
                            "exerciseId": 1035,
                            "routineSets": [
                                {
                                    "rpe": 7,
                                    "reps": 10,
                                    "speedKmh": null,
                                    "weightKg": 60,
                                    "distanceM": null,
                                    "durationSec": null,
                                    "restTimeSec": 90
                                },
                                {
                                    "rpe": 7,
                                    "reps": 10,
                                    "speedKmh": null,
                                    "weightKg": 60,
                                    "distanceM": null,
                                    "durationSec": null,
                                    "restTimeSec": 90
                                }
                            ],
                            "exerciseName": "루마니안 데드리프트(RDL)"
                        },
                        {
                            "exerciseId": 1038,
                            "routineSets": [
                                {
                                    "rpe": 6,
                                    "reps": 12,
                                    "speedKmh": null,
                                    "weightKg": 40,
                                    "distanceM": null,
                                    "durationSec": null,
                                    "restTimeSec": 60
                                },
                                {
                                    "rpe": 6,
                                    "reps": 12,
                                    "speedKmh": null,
                                    "weightKg": 40,
                                    "distanceM": null,
                                    "durationSec": null,
                                    "restTimeSec": 60
                                }
                            ],
                            "exerciseName": "굿모닝"
                        }
                    ]
                },
                {
                    "name": "루틴 3",
                    "routineExercises": [
                        {
                            "exerciseId": 1009,
                            "routineSets": [
                                {
                                    "rpe": 6,
                                    "reps": 15,
                                    "speedKmh": null,
                                    "weightKg": null,
                                    "distanceM": null,
                                    "durationSec": null,
                                    "restTimeSec": 60
                                },
                                {
                                    "rpe": 6,
                                    "reps": 15,
                                    "speedKmh": null,
                                    "weightKg": null,
                                    "distanceM": null,
                                    "durationSec": null,
                                    "restTimeSec": 60
                                }
                            ],
                            "exerciseName": "클로즈그립 푸쉬업"
                        },
                        {
                            "exerciseId": 1010,
                            "routineSets": [
                                {
                                    "rpe": 7,
                                    "reps": 12,
                                    "speedKmh": null,
                                    "weightKg": null,
                                    "distanceM": null,
                                    "durationSec": null,
                                    "restTimeSec": 90
                                },
                                {
                                    "rpe": 7,
                                    "reps": 12,
                                    "speedKmh": null,
                                    "weightKg": null,
                                    "distanceM": null,
                                    "durationSec": null,
                                    "restTimeSec": 90
                                }
                            ],
                            "exerciseName": "딥스"
                        }
                    ]
                },
                {
                    "name": "루틴 4",
                    "routineExercises": [
                        {
                            "exerciseId": 1061,
                            "routineSets": [
                                {
                                    "rpe": 8,
                                    "reps": null,
                                    "speedKmh": null,
                                    "weightKg": null,
                                    "distanceM": null,
                                    "durationSec": 30,
                                    "restTimeSec": 30
                                },
                                {
                                    "rpe": 8,
                                    "reps": null,
                                    "speedKmh": null,
                                    "weightKg": null,
                                    "distanceM": null,
                                    "durationSec": 30,
                                    "restTimeSec": 30
                                }
                            ],
                            "exerciseName": "마운틴 클라이밍"
                        },
                        {
                            "exerciseId": 1062,
                            "routineSets": [
                                {
                                    "rpe": 7,
                                    "reps": null,
                                    "speedKmh": null,
                                    "weightKg": null,
                                    "distanceM": null,
                                    "durationSec": 20,
                                    "restTimeSec": 40
                                },
                                {
                                    "rpe": 7,
                                    "reps": null,
                                    "speedKmh": null,
                                    "weightKg": null,
                                    "distanceM": null,
                                    "durationSec": 20,
                                    "restTimeSec": 40
                                }
                            ],
                            "exerciseName": "할로우 홀드"
                        }
                    ]
                },
                {
                    "name": "루틴 5",
                    "routineExercises": [
                        {
                            "exerciseId": 1099,
                            "routineSets": [
                                {
                                    "rpe": 7,
                                    "reps": 12,
                                    "speedKmh": null,
                                    "weightKg": null,
                                    "distanceM": null,
                                    "durationSec": null,
                                    "restTimeSec": 60
                                },
                                {
                                    "rpe": 7,
                                    "reps": 12,
                                    "speedKmh": null,
                                    "weightKg": null,
                                    "distanceM": null,
                                    "durationSec": null,
                                    "restTimeSec": 60
                                }
                            ],
                            "exerciseName": "런지 워크"
                        },
                        {
                            "exerciseId": 1083,
                            "routineSets": [
                                {
                                    "rpe": 8,
                                    "reps": 10,
                                    "speedKmh": null,
                                    "weightKg": 30,
                                    "distanceM": null,
                                    "durationSec": null,
                                    "restTimeSec": 90
                                },
                                {
                                    "rpe": 8,
                                    "reps": 10,
                                    "speedKmh": null,
                                    "weightKg": 30,
                                    "distanceM": null,
                                    "durationSec": null,
                                    "restTimeSec": 90
                                }
                            ],
                            "exerciseName": "레니게이드 로우"
                        }
                    ]
                }
            ]
        }
    },
    "inputTokens": 7388,
    "outputTokens": 1679,
    "requestTime": "2026-01-20T23:56:46.341044",
    "responseTime": "2026-01-20T23:57:21.674063",
    "elapsedMs": 35333,
    "status": "SUCCESS",
    "statusMessage": "OK",
    "userFeedBack": null,
    "userFeedBackReason": null,
    "userAction": null
}
```



`inputContent`의 `userMessage`도 `outputContent` 처럼 구조화된 json형식으로 저장하고 싶음. 일단 엔티티에서 똑같은 데이터 타입 형식으로 다루고 있으나 파싱이 안되고 있음.

```java
// 내용 전부 저장  
@Convert(converter = JsonMapConverter.class)  
@Column(name = "input_content", columnDefinition = "json")  
@Builder.Default  
private Map<String, Object> inputContent = new HashMap<>();  
  
// 내용 전부 저장  
@Convert(converter = JsonMapConverter.class)  
@Column(name = "output_content", columnDefinition = "json")  
@Builder.Default  
private Map<String, Object> outputContent = new HashMap<>();
```

```json
{

    "id": 3,

    "requestId": "4743603a-f5c1-4c02-97db-fc49aab4d7da",

    "userId": 1,

    "model": "GPT_4_1_MINI",

    "feature": "ROUTINE_RECOMMEND",

    "version": "0.0.1",

    "inputContent": {

        "userMessage": "{\"age\":25,\"workoutGoals\":[\"WEIGHT_LOSS\",\"MUSCLE_GAIN\"],\"exerciseCategories\":[\"FITNESS\",\"CROSSFIT\"],\"disease\":\"허리 디스크\",\"height\":175.0,\"weight\":72.5,\"skeletalMuscleMass\":32.1,\"bodyFatMass\":20.4,\"bodyFatPercentage\":20.4,\"bmi\":23.7,\"splitCount\":5}",

        "systemPrompt": "# 시스템 지침\n- 당신은 운동 루틴 추천을 생성하는 AI이다.\n- 반드시 아래 \"응답 형식\"을 만족하는 JSON만 출력한다.\n- JSON 외의 텍스트(설명/주석/코드펜스/마크다운/인삿말/추가 문장)를 절대 출력하지 않는다.\n- 최상위는 JSON 객체 1개여야 한다.\n- 최상위 객체는 반드시 \"result\" 프로퍼티를 가진다.\n- \"result\"는 반드시 배열(array)이어야 하며, 최소 1개 이상의 루틴 객체를 포함해야 한다.\n\n# 데이터 제약\n- exerciseId, exerciseName은 \"서버가 제공한 목록\"에 포함된 운동만 사용할 수 있다.\n- candidateExercises 목록에 없는 운동을 새로 만들어내거나 임의로 추정하지 않는다.\n- exerciseId와 exerciseName은 항상 서로 일치해야 한다. (예: id 10의 name이 '벤치프레스'면 다른 이름을 쓰면 안 됨)\n- 유저 메시지(나이/목표/질환/선호 부위/분할 수 등)를 참고하여 루틴을 구성한다.\n- 사용자가 요청한 분할 수와 result 배열의 길이와 동일하다.\n\n# 값 규칙\n- RoutineSet의 수치 필드는 다음 규칙을 따른다.\n  - weightKg: 정수 또는 null (맨몸/체중운동이면 null 가능)\n  - reps: 정수 또는 null (유산소/시간기반이면 null 가능)\n  - distanceM: 정수 또는 null (거리 기반 운동일 때만 값)\n  - durationSec: 정수 또는 null (시간 기반 운동일 때만 값)\n  - speedKmh: 정수 또는 null (속도 기반 운동일 때만 값)\n  - rpe: 정수 또는 null (자각강도 1~10 권장, 모르면 null)\n  - restTimeSec: 정수 또는 null (세트 간 휴식, 모르면 null)\n- 위 필드들 중 해당 운동에 의미 없는 값은 null로 둔다. (예: 근력운동에서 distanceM은 null)\n- 숫자 값은 문자열로 출력하지 않는다. (따옴표 없이 숫자로 출력)\n\n# 응답 형식 (AIRoutineResponse DTO)\n아래 JSON 구조를 반드시 정확히 따른다. 키 이름/대소문자/중첩 구조를 변경하지 않는다.\n\n{\n  \"result\": [\n    {\n      \"name\": \"string\",\n      \"routineExercises\": [\n        {\n          \"exerciseId\": 0,\n          \"exerciseName\": \"string\",\n          \"routineSets\": [\n            {\n              \"weightKg\": 0,\n              \"reps\": 0,\n              \"distanceM\": 0,\n              \"durationSec\": 0,\n              \"speedKmh\": 0,\n              \"rpe\": 0,\n              \"restTimeSec\": 0\n            }\n          ]\n        }\n      ]\n    }\n  ]\n}\n\n# 추가 출력 금지\n- 위 JSON 객체 외에는 어떤 문자도 출력하지 않는다.\n- JSON을 ```json 코드블록으로 감싸지 않는다.\n",

        "inputAssistantMessage": ""

    },

    "outputContent": {

        "result": {

            "result": [

                {

                    "name": "월요일 - 상체 근력",

                    "routineExercises": [

                        {

                            "exerciseId": 1001,

                            "routineSets": [

                                {

                                    "rpe": 7,

                                    "reps": 8,

                                    "speedKmh": null,

                                    "weightKg": 50,

                                    "distanceM": null,

                                    "durationSec": null,

                                    "restTimeSec": 90

                                }

                            ],

                            "exerciseName": "벤치프레스"

                        },

                        {

                            "exerciseId": 1003,

                            "routineSets": [

                                {

                                    "rpe": 7,

                                    "reps": 10,

                                    "speedKmh": null,

                                    "weightKg": 40,

                                    "distanceM": null,

                                    "durationSec": null,

                                    "restTimeSec": 90

                                }

                            ],

                            "exerciseName": "디클라인 프레스"

                        },

                        {

                            "exerciseId": 1012,

                            "routineSets": [

                                {

                                    "rpe": 6,

                                    "reps": 12,

                                    "speedKmh": null,

                                    "weightKg": 20,

                                    "distanceM": null,

                                    "durationSec": null,

                                    "restTimeSec": 60

                                }

                            ],

                            "exerciseName": "아널드 프레스"

                        }

                    ]

                },

                {

                    "name": "화요일 - 하체 및 코어",

                    "routineExercises": [

                        {

                            "exerciseId": 1035,

                            "routineSets": [

                                {

                                    "rpe": 7,

                                    "reps": 10,

                                    "speedKmh": null,

                                    "weightKg": 40,

                                    "distanceM": null,

                                    "durationSec": null,

                                    "restTimeSec": 90

                                }

                            ],

                            "exerciseName": "루마니안 데드리프트(RDL)"

                        },

                        {

                            "exerciseId": 1065,

                            "routineSets": [

                                {

                                    "rpe": 5,

                                    "reps": 15,

                                    "speedKmh": null,

                                    "weightKg": null,

                                    "distanceM": null,

                                    "durationSec": null,

                                    "restTimeSec": 60

                                }

                            ],

                            "exerciseName": "V업"

                        },

                        {

                            "exerciseId": 1070,

                            "routineSets": [

                                {

                                    "rpe": 6,

                                    "reps": null,

                                    "speedKmh": null,

                                    "weightKg": null,

                                    "distanceM": null,

                                    "durationSec": 45,

                                    "restTimeSec": 60

                                }

                            ],

                            "exerciseName": "플랭크 행 델트"

                        }

                    ]

                },

                {

                    "name": "수요일 - 휴식 및 회복",

                    "routineExercises": []

                },

                {

                    "name": "목요일 - 전신 크로스핏",

                    "routineExercises": [

                        {

                            "exerciseId": 1098,

                            "routineSets": [

                                {

                                    "rpe": 8,

                                    "reps": 12,

                                    "speedKmh": null,

                                    "weightKg": null,

                                    "distanceM": null,

                                    "durationSec": null,

                                    "restTimeSec": 90

                                }

                            ],

                            "exerciseName": "벌피+플랭크 푸쉬업 복합"

                        },

                        {

                            "exerciseId": 1051,

                            "routineSets": [

                                {

                                    "rpe": 7,

                                    "reps": 10,

                                    "speedKmh": null,

                                    "weightKg": null,

                                    "distanceM": null,

                                    "durationSec": null,

                                    "restTimeSec": 60

                                }

                            ],

                            "exerciseName": "플래드크"

                        }

                    ]

                },

                {

                    "name": "금요일 - 유산소 및 코어 강화",

                    "routineExercises": [

                        {

                            "exerciseId": 1023,

                            "routineSets": [

                                {

                                    "rpe": 6,

                                    "reps": 15,

                                    "speedKmh": null,

                                    "weightKg": null,

                                    "distanceM": null,

                                    "durationSec": null,

                                    "restTimeSec": 60

                                }

                            ],

                            "exerciseName": "킥센트레이션 킥"

                        },

                        {

                            "exerciseId": 1007,

                            "routineSets": [

                                {

                                    "rpe": 6,

                                    "reps": 20,

                                    "speedKmh": null,

                                    "weightKg": null,

                                    "distanceM": null,

                                    "durationSec": null,

                                    "restTimeSec": 60

                                }

                            ],

                            "exerciseName": "푸쉬업"

                        }

                    ]

                }

            ]

        }

    },

    "inputTokens": 7350,

    "outputTokens": 1118,

    "requestTime": "2026-01-23T23:37:18.501011",

    "responseTime": "2026-01-23T23:37:36.462495",

    "elapsedMs": 17961,

    "status": "SUCCESS",

    "statusMessage": "OK",

    "userFeedBack": null,

    "userFeedBackReason": null,

    "userAction": null

}
```