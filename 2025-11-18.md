
- [x] CS 공부
- [x] 확장 함수 정리



# 이슈 : DTO 정보들을 어떻게 Model에게 전달할까?
## 객체 매핑

```kotlin
model.addAttribute("data", response)
```
기존에는 다음과 같이 응답값 자체를 통으로 넘기는 식으로 진행했다.

```jsp
<div class="summary-card">
	<h2>${data.quizName}</h2>

	<div class="score-display">
		<span class="score-value">${data.score}</span>
		<span class="score-total">/ ${fn:length(data.answers)}</span>
	</div>

	<div class="summary-meta">
		<span class="level-badge">${data.level}</span>
		<span>
			완료: <c:out value="${data.completedAt}"/>
		</span>
	</div>
</div>
```
그로 인해 이와 같은 방식으로 프로퍼티를 접근했다.

## 앞에 data를 없애보자
```jsp
<c:forEach var="quizName" items="${data.quizName}" varStatus="status">
<c:forEach var="score" items="${data.score}" varStatus="status">
```
이와 같은 방식으로 값을 지정하여 관리해야 될 것이다.

```kotlin
model.addAttribute("path", "content/quiz/config/detail.jsp")  
model.addAttribute("configId", response.configId)  
model.addAttribute("quizName", response.quizName)  
model.addAttribute("level", response.level)  
model.addAttribute("updatedAt", response.updatedAt)  
model.addAttribute("createdAt", response.createdAt)  
model.addAttribute("quizzes", response.quizzes)
```
혹은 서버에서 이와 같이 각각의 프로퍼티를 대입해야 한다.

좀 더 쉽게 대입하는 방법은 없을까?
```kotlin
val path = "content/quiz/config/detail.jsp"  
model.addAllAttributes(  
    listOf<Any>(  
        path,  
        response.configId,  
        response.quizName,  
        response.level,  
        response.updatedAt,  
        response.createdAt,  
        response.quizzes,  
    )
)
```
다행이 `addAllAttributes`가 있어 이를 활용해봤다.
그러나 에러 발생한다.

```java
for (value in list) {
    model.addAttribute(value) // 이름 없이
}
```
해당 메서드는 내부적으로 이와 같이 동작하며
이름 없이 attribute를 add하기에 타입이 이름이 되버린다

```jsp
${string}   <!-- path, quizName 중 어느 쪽이 들어가 있을지 모름 -->
${long}     <!-- configId -->
```

```kotlin
model.addAllAttributes(  
    mapOf(  
        "path" to "content/quiz/config/detail.jsp",  
        "configId" to response.configId,  
        "quizName" to response.quizName,  
        "level" to response.level,  
        "updatedAt" to response.updatedAt,  
        "createdAt" to response.createdAt,  
        "quizzes" to response.quizzes,  
    )  
)
```
그렇기에 이런식으로 만들어야 한다.

이러한 반복적인 코드는 개발자를 괴롭게 할 뿐만 아니라 실수하기 딱 좋은 코드이다.

### 팀원이 작성한 작성한 코드 중...
```kotlin
model.addAttribute(  
    "data", mapOf(  
        "users" to users,  
        "currentUserId" to currentUser.id  
    )  
)
```
 이렇게까지 매핑하여 구현한 팀원들은 요구사항 변경 소식을 듣게 된다면 매우 분노할 것이다.
 그러면 어떻게 해야할까?

이를 쉽게 매핑하기 위한 유틸형 함수를 만들어보자!

## 확장함수 활용
```kotlin
inline fun <reified T : Any> Model.addFrom(dto: T) {  
    T::class.memberProperties.forEach { prop ->  
        val value = prop.get(dto)  
        this.addAttribute(prop.name, value)  
    }  
}
```
리플렉션과 DTO를 활용하여 DTO 내부 각 프로퍼티들의 이름과 값을 기반으로 `addAttribute` 실행 
### 사용
```kotlin
model.addFrom(response)
```
