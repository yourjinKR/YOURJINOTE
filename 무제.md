
## JWT 생성 실패 이슈

### 개요

Spring Security + OAuth2 소셜 로그인 구현 과정에서  
**소셜 로그인 성공 후 JWT 생성 단계에서 예외가 발생**하여 인증 플로우가 중단되는 문제가 발생함.

DB 조회 및 인증 자체는 정상적으로 수행되었으나,  
JWT Access Token 발급 시점에서 런타임 예외가 발생함.

### 상황

```
io.jsonwebtoken.security.UnsupportedKeyException:
Unable to determine a suitable MAC or Signature algorithm for the specified key
```

```java
String secretKeyString = "yourjinfitsyncoriginalv2"; // 약 22 bytes
```

#### SecretKey 직접 생성 방식의 한계

```java
secretKey = new SecretKeySpec(
    secretKeyString.getBytes(StandardCharsets.UTF_8),
    Jwts.SIG.HS256.key().build().getAlgorithm()
);
```

- 알고리즘 문자열만 HS256으로 지정
- **키 길이 검증을 JJWT 내부 로직에 맡기지 못함**
- JJWT 0.12.x부터는 해당 방식에 대해 검증이 더 엄격해짐

#### 해결 방식

```java
static {
    String secretKeyString =
        "yourjinfitsyncoriginalv2-very-long-secret-key-32bytes+";

    secretKey = Keys.hmacShaKeyFor(
        secretKeyString.getBytes(StandardCharsets.UTF_8)
    );
}
```

- 키 길이를 보장하기 위해 `Keys.hmacShaKeyFor()` 사용
- 최소 32바이트 이상의 키 사용

> jjwt 내부적으로 키 길이 검증 후 HS256에 맞는 MAC 알고리즘 자동 선택을 안전하게 처리함.


### 정리

JWT Secret Key는 단순 문자열이 아니라 “암호 키”라는 인식이 필요
- JJWT 0.12.x부터는 보안 요구사항이 강화되어 키의 길이와 생성방식이 중요
- `SecretKeySpec` 직접 생성보다  
    **`Keys.hmacShaKeyFor()` 사용이 사실상 필수**

#### 개선사항

- JWT Secret Key를 `application.yml` 또는 환경변수로 분리
- Base64 인코딩된 키 사용
- 운영 환경에서 키 로테이션 전략 고려