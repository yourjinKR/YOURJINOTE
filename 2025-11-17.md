- [x] 퀴즈 설정 submit 테스트
- [x] 권한 처리
- [x] 주석 및 콘솔 제거

# JSP와 session
## 🧩 코드 설명

```kotlin
val loginId = session.getAttribute("loginId") as? String
    ?: return "redirect:/view/users/login"
```

### 1️⃣ `session.getAttribute("loginId")`

- 현재 사용자의 **세션(Session)** 에 저장된 `"loginId"`라는 속성값을 가져옵니다.
    
- 예를 들어, 사용자가 로그인할 때 다음과 같이 세션에 로그인 정보를 저장해둔 경우를 가정할 수 있습니다:
    
    ```kotlin
    session.setAttribute("loginId", user.loginId)
    ```
    
    이렇게 하면 세션에 `loginId`라는 이름으로 사용자의 아이디가 저장됩니다.
    

---

### 2️⃣ `as? String`

- 세션에서 꺼낸 값이 `Any?` 타입이기 때문에, **`String`으로 안전하게 캐스팅**하는 코드입니다.
    
- `as?` 연산자는 **캐스팅에 실패하면 `null`을 반환**합니다.
    

---

### 3️⃣ `?: return "redirect:/view/users/login"`

- **엘비스 연산자(`?:`)**를 사용한 null 처리입니다.
    
- 만약 `session.getAttribute("loginId")`가 `null`이라면 (즉, 로그인하지 않은 사용자라면)  
    `"redirect:/view/users/login"`으로 리다이렉트시킵니다.
    

---

✅ **정리하자면**

> 로그인된 사용자가 아니면 로그인 페이지로 리다이렉트하고,  
> 로그인된 경우에는 세션에서 `loginId`를 꺼내서 이후 코드에서 사용하게 됩니다.

---

## 🧭 JSP에서 `loginId` 사용하는 방법

세션에 저장된 속성은 JSP에서 바로 접근할 수 있습니다.  
즉, 컨트롤러에서 별도로 `model.addAttribute("loginId", loginId)`를 하지 않아도  
JSP에서는 다음과 같이 사용할 수 있습니다:

### ✅ 방법 1: JSTL로 출력

```jsp
<p>로그인 아이디: ${sessionScope.loginId}</p>
```

- `sessionScope`는 세션 영역에 접근하는 JSTL 내장 객체입니다.
    
- 위 코드는 세션에서 `loginId` 속성을 꺼내서 출력합니다.
    

---

### ✅ 방법 2: EL 없이 스크립틀릿 사용 (비추천)

```jsp
<%
    String loginId = (String) session.getAttribute("loginId");
    out.println("로그인 아이디: " + loginId);
%>
```

> 하지만 이 방식은 **JSP 스크립틀릿을 사용하므로 유지보수가 어렵고 가독성이 떨어집니다.**  
> 요즘은 JSTL (`${}`) 표기법을 사용하는 게 일반적입니다.

---

### ✅ 방법 3: 로그인 상태에 따라 조건부 렌더링

```jsp
<c:choose>
    <c:when test="${not empty sessionScope.loginId}">
        <p>${sessionScope.loginId}님 환영합니다!</p>
    </c:when>
    <c:otherwise>
        <a href="/view/users/login">로그인</a>
    </c:otherwise>
</c:choose>
```

> 이렇게 하면 로그인 여부에 따라 다른 화면을 보여줄 수 있습니다.

---

## 💡 요약

| 항목         | 내용                                                            |
| ---------- | ------------------------------------------------------------- |
| 코드 역할      | 세션에 `loginId`가 없으면 로그인 페이지로 리다이렉트                             |
| 세션에서 값 꺼내기 | `session.getAttribute("loginId")`                             |
| JSP에서 접근   | `${sessionScope.loginId}`                                     |
| 조건부 출력     | `<c:if test="${not empty sessionScope.loginId}"> ... </c:if>` |

---

원하신다면 이 `loginId`를 JSP header(예: 상단 네비게이션)에 표시하는 예시 코드도 같이 만들어드릴까요?

# JSP에서 session을 다루고 js에서도 다루기

## 🧩 전제

Spring MVC + JSP 환경에서는 로그인 시점에 다음과 같이 세션에 로그인 아이디가 저장되어 있다고 가정합니다.

```kotlin
session.setAttribute("loginId", user.loginId)
```

그럼 JSP에서 다음 코드로 접근할 수 있습니다.

```jsp
${sessionScope.loginId}
```

---

## ✅ 방법 1: JSP의 EL(Expression Language)을 JS 변수로 넘기기 (가장 일반적인 방법)

```jsp
<script>
    // JSP의 sessionScope에서 값을 가져와 JS 변수에 저장
    const loginId = "${sessionScope.loginId}";
    console.log("로그인 아이디:", loginId);

    if (!loginId) {
        alert("로그인이 필요합니다!");
        location.href = "/view/users/login";
    }
</script>
```

### 📘 동작 원리

- JSP가 서버에서 렌더링될 때 `${sessionScope.loginId}`가 실제 문자열 값으로 치환됩니다.
    
- 예를 들어, 로그인된 사용자의 `loginId`가 `"young123"`이라면,  
    렌더링된 실제 HTML은 다음과 같습니다.
    

```html
<script>
    const loginId = "young123";
</script>
```

- 로그인되지 않은 경우 (즉, `sessionScope.loginId`가 null인 경우),  
    빈 문자열로 치환되어 `const loginId = "";`가 됩니다.
    

---

## ✅ 방법 2: 데이터 속성(`data-*`)으로 JSP 값 전달 후 JS에서 읽기

HTML 태그의 `data` 속성을 활용할 수도 있습니다.

```jsp
<body data-login-id="${sessionScope.loginId}">
<script>
    const loginId = document.body.dataset.loginId;
    console.log("로그인 아이디:", loginId);

    if (!loginId) {
        alert("로그인이 필요합니다.");
        location.href = "/view/users/login";
    }
</script>
</body>
```

### 📘 장점

- JS 코드가 HTML 렌더링과 분리되어 있을 때 (예: 외부 JS 파일 사용) 유용합니다.
    
- 외부 JS에서는 이렇게 접근 가능합니다:
    
    ```javascript
    const loginId = document.body.dataset.loginId;
    ```
    

---

## ✅ 방법 3: `meta` 태그로 전달 (헤더에서 자주 사용)

```jsp
<head>
    <meta name="login-id" content="${sessionScope.loginId}">
</head>
<script>
    const loginId = document.querySelector('meta[name="login-id"]').content;
    console.log("로그인 아이디:", loginId);
</script>
```

> ⚙️ **적용 예시:** SPA처럼 헤더에 로그인 정보를 숨겨두고 JS가 동적으로 UI를 렌더링할 때 사용됩니다.

---

## ⚠️ 주의사항

1. **EL 표현식은 반드시 JSP 내부에서만 사용 가능**합니다.  
    외부 `.js` 파일에서는 `${sessionScope.loginId}`를 직접 사용할 수 없습니다.  
    외부 JS 파일에서 필요하다면 위처럼 `data-*`나 `<meta>` 태그로 값을 전달하세요.
    
2. **보안상 민감한 정보(비밀번호, 이메일 등)는 절대 JS로 전달하지 마세요.**  
    `loginId` 정도는 식별용이므로 일반적으로 괜찮습니다.
    

---

## 💡 예시: 로그인 상태에 따라 버튼 제어

```jsp
<button id="login-btn">로그인</button>
<button id="logout-btn" style="display:none;">로그아웃</button>

<script>
    const loginId = "${sessionScope.loginId}";

    if (loginId) {
        document.getElementById("login-btn").style.display = "none";
        document.getElementById("logout-btn").style.display = "block";
        console.log(`${loginId}님 환영합니다.`);
    }
</script>
```

---

## 🧭 정리

|방법|설명|외부 JS에서 사용 가능 여부|
|---|---|---|
|`${sessionScope.loginId}` 직접 대입|JSP 내부 스크립트에서만 가능|❌|
|`data-*` 속성|HTML에 숨겨서 JS에서 읽기|✅|
|`<meta>` 태그|문서 헤더에서 전달|✅|

---

원하신다면 “외부 JS 파일(app.js)”에서 세션 값을 읽는 구조로도 예시를 만들어드릴까요? (예: `/static/js/app.js`에서 session 값 접근)